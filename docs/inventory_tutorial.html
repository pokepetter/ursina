<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Tutorial</title>
    <link rel="stylesheet" type="text/css" href="index_style.css">
</head>

<body>
    <div class="container">
        <div class="topic">
            Inventory Tutorial<br>
        </div>
        <div class="text">
            In this tutorial we will make a drag and drop inventory like this.
        </div>
        <div class="image">
            <img src="inventory_2.gif" max-width=100%>
        </div>
        <div class="topic">
            1. Setting up the class
        </div>
        <div class="text">
            Let's begin by making an Inventory class.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__()
                <br>
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br> app.run()
            </div>
        </div>
        <div class="topic">
            2. Adding graphics
        </div>
        <div class="text">
            However, if we run the code, we'll see that there's nothing visible.
            <br>Let's parent it to the ui and set the model to 'quad', an included model.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__(
                <br><mark> parent = camera.ui, </mark>
                <br><mark> model = <font color="green">'quad'</font> </mark>
                <br> )
                <br>
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br> app.run()
            </div>
            If we look at it now, we see it's a white square in the middle of the screen.
            <br>Let's set it to a nicer shape. We also want (0,0) to be in the upper left corner
            <br>because it makes it easier to add items later. Let's also give it a texture and a color.
            <br>If we have both, the color value will tint the texture.
            <br>
            <br>Now, this is nice and all, but wouldn't it be nice to show a grid as well.
            <br>There multiple way tp do that, but for this ase, we'll simply make the texture repeat
            <br>by setting texture_scale to (5,6). That'll nicely fit the size of our inventory.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__(
                <br> parent = camera.ui,
                <br> model = <font color="green">'quad'</font>,
                <br><mark> scale = (.5, .8), </mark>
                <br><mark> origin = (-.5, .5), </mark>
                <br><mark> position = (-.3,.4), </mark>
                <br><mark> texture = <font color="green">'white_cube'</font>, </mark>
                <br><mark> texture_scale = (5,8), </mark>
                <br><mark> color = color.dark_gray </mark>
                <br> )
                <br>
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br> app.run()
            </div>
        </div>
        <div class="topic">
            3. Adding placeholder items
        </div>
        <div class="text">
            Let's try to add some items to the inventory.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__(
                <br> parent = camera.ui,
                <br> model = <font color="green">'quad'</font>,
                <br> scale = (.5, .8),
                <br> origin = (-.5, .5),
                <br> position = (-.3,.4),
                <br> texture = <font color="green">'white_cube'</font>,
                <br> texture_scale = (5,8),
                <br> color = color.dark_gray
                <br> )
                <br>
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br><mark> item = Button(parent=inventory, color=color.red, position=(0,0)) </mark>
                <br><mark> item = Button(parent=inventory, color=color.green, position=(2,0)) </mark>
                <br> app.run()
            </div>
            We'll, that didn't go as planned. The items cover the entire inventory and
            <br>the second item is way off to the left.
            <br>Let's fix this by making another object to put the items under.
            <br>Scale the object to the size of an item.
            <br>
            <br>They also don't fit the grid. Fix that by setting origin to the upper left
            <br>corner, (-.5,.5) that is.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__(
                <br> parent = camera.ui,
                <br> model = <font color="green">'quad'</font>,
                <br> scale = (.5, .8),
                <br> origin = (-.5, .5),
                <br> position = (-.3,.4),
                <br> texture = <font color="green">'white_cube'</font>,
                <br> texture_scale = (5,8),
                <br> color = color.dark_gray
                <br> )
                <br>
                <br><mark> self.item_parent = <font color="olive">Entity</font>(parent=self, scale=(1/5,1/8)) </mark>
                <br>
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br><mark> item = Button(parent=inventory.item_parent, origin=(-.5,.5), color=color.red, position=(0,0)) </mark>
                <br><mark> item = Button(parent=inventory.item_parent, origin=(-.5,.5), color=color.green, position=(2,0)) </mark>
                <br> app.run()
            </div>
        </div>
        <div class="topic">
            4. Adding items
        </div>
        <div class="text">
            We've added some items manually to make sure they get the right scale and position,
            <br>but we should make an append() function so it's easy to add items.
            <br>
            <br>Let's start by making a function called 'append()' and make it spawn an item
            <br>when we send it a string. We'll also set the button's text to the string we
            <br>recieve so we can differentiate them.
            <br>Let's give them a random color too, why not.
            <br>
            <br>Lastly, let's call inventory.append('test item') a couple of times to make sure it works.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__(
                <br> parent = camera.ui,
                <br> model = <font color="green">'quad'</font>,
                <br> scale = (.5, .8),
                <br> origin = (-.5, .5),
                <br> position = (-.3,.4),
                <br> texture = <font color="green">'white_cube'</font>,
                <br> texture_scale = (5,8),
                <br> color = color.dark_gray
                <br> )
                <br>
                <br> self.item_parent = <font color="olive">Entity</font>(parent=self, scale=(1/5,1/8))
                <br>
                <br>
                <br><mark>
                    <font color="purple">def</font> append(self, item):
                </mark>
                <br><mark> Button( </mark>
                <br><mark> parent = inventory.item_parent, </mark>
                <br><mark> model = <font color="green">'quad'</font>, </mark>
                <br><mark> origin = (-.5,.5), </mark>
                <br><mark> color = color.random_color(), </mark>
                <br><mark> z = -.1 </mark>
                <br> )
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br><mark> inventory.append(<font color="green">'test item'</font>) </mark>
                <br><mark> inventory.append(<font color="green">'test item'</font>) </mark>
                <br> app.run()
            </div>
        </div>
        <div class="topic">
            5. Find a free slot in the inventory
        </div>
        <div class="text">
            The items gets added, but they overlap. We need to find the first open slot in the inventory
            <br>and place the item there. We can to this by checking each grid position and see if any
            <br>if the items occupy that position already.
            <div class="spoiler">
                <font color="purple">from</font> ursina <font color="purple">import</font> *
                <br>
                <br>class Inventory(<font color="olive">Entity</font>):
                <br>
                <font color="purple">def</font> __init__(self):
                <br> super().__init__(
                <br> parent = camera.ui,
                <br> model = <font color="green">'quad'</font>,
                <br> scale = (.5, .8),
                <br> origin = (-.5, .5),
                <br> position = (-.3,.4),
                <br> texture = <font color="green">'white_cube'</font>,
                <br> texture_scale = (5,8),
                <br> color = color.dark_gray
                <br> )
                <br>
                <br> self.item_parent = <font color="olive">Entity</font>(parent=self, scale=(1/5,1/8))
                <br>
                <br>
                <br><mark>
                    <font color="purple">def</font> find_free_spot(self):
                </mark>
                <br><mark> taken_spots = [(int(e.x), int(e.y)) for e in self.item_parent.children] </mark>
                <br><mark> for y in range(8): </mark>
                <br><mark> for x in range(5): </mark>
                <br><mark> if not (x,-y) in taken_spots: </mark>
                <br><mark> return (x,-y) </mark>
                <br>
                <br>
                <br>
                <font color="purple">def</font> append(self, item):
                <br> Button(
                <br> parent = inventory.item_parent,
                <br> model = <font color="green">'quad'</font>,
                <br> origin = (-.5,.5),
                <br> color = color.random_color(),
                <br><mark> position = self.find_free_spot(), </mark>
                <br> z = -.1
                <br> )
                <br>
                <br>
                <br>if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br><mark> for i in range(7): </mark>
                <br><mark> inventory.append(<font color="green">'test item'</font>) </mark>
                <br> app.run()
            </div>
        </div>
        <div class="topic">
            6. Add random item button
        </div>
        <div class="text">
            Make a button to add a random item to the inventory. This is not part of the inventory itself,
            <br>but it's useful to test it.
            <br>Assign the button's 'on_click' to a function, and it will call that function when we click it.
            <br>button.on_click = inventory
            <br>
            <br>Let's make an tuple with those and make the button choose a random item from the tuple
            <br>using random.choice(items)
            <div class="spoiler">
                if __name__ == <font color="green">'__main__'</font>:
                <br> app = Ursina()
                <br> inventory = Inventory()
                <br>
                <br><mark>
                    <font color="purple">def</font> add_item():
                </mark>
                <br><mark> inventory.append(random.choice((<font color="green">'bag'</font>, <font color="green">'bow_arrow'</font>, <font color="green">'gem'</font>, <font color="green">'orb'</font>, <font color="green">'sword'</font>))) </mark>
                <br>
                <br><mark> for i in range(7): </mark>
                <br><mark> add_item() </mark>
                <br>
                <br><mark> add_item_button = Button( </mark>
                <br><mark> scale = (.1,.1), </mark>
                <br><mark> x = -.5, </mark>
                <br><mark> color = color.lime.tint(-.25), </mark>
                <br><mark> text = <font color="green">'+'</font>, </mark>
                <br><mark> tooltip = Tooltip(<font color="green">'Add random item'</font>), </mark>
                <br><mark> on_click = add_item </mark>
                <br><mark> ) </mark>
                <br>
                <br> app.run()
            </div>
        </div>
        <div class="topic">
            7. Adding textures and hover text
        </div>
        <div class="text">
            To add textures, just set texture=item and it will try to find a
            <br>texture with that name. It searches first in the project's assets and then
            <br>in the assets included with ursina. I've included some icons for the purpose
            <br>if this tutorial, but feel free to add your own.
            <br>
            <br>Let's also remove the random color and instead show the item's name when we hover it with the mouse.
            <br>If a button has 'tooltip' set to something. It will show it when we hover the Button.
            <div class="spoiler">
                <font color="purple">def</font> append(self, item):
                <br><mark> icon = Button( </mark>
                <br> parent = inventory.item_parent,
                <br> model = <font color="green">'quad'</font>,
                <br><mark> texture = item, </mark>
                <br><mark> color = color.white, </mark>
                <br> origin = (-.5,.5),
                <br> position = self.find_free_spot(),
                <br> z = -.1,
                <br> )
                <br><mark> name = item.replace(<font color="green">'_'</font>, <font color="green">' '</font>).title() </mark>
                <br><mark> icon.tooltip = Tooltip(name) </mark>
                <br><mark> icon.tooltip.background.color = color.color(0,0,0,.8) </mark>
            </div>
        </div>
        <div class="topic">
            8. Drag n' drop
        </div>
        <div class="text">
            We can't move the items! That's not fun.
            <br>However's that's easy to change, just spawn a Draggable instead of Button.
            <br>Draggable inherits from Button, so the tooltips will still work!
            <div class="spoiler">
                <font color="purple">def</font> append(self, item):
                <br><mark> icon = Draggable( </mark>
                <br> parent = inventory.item_parent,
                <br> model = <font color="green">'quad'</font>,
                <br> texture = item,
                <br> color = color.white,
                <br> origin = (-.5,.5),
                <br> position = self.find_free_spot(),
                <br> z = -.1,
                <br> )
                <br> name = item.replace(<font color="green">'_'</font>, <font color="green">' '</font>).title()
                <br> icon.tooltip = Tooltip(name)
                <br> icon.tooltip.background.color = color.color(0,0,0,.8)
            </div>
        </div>
        <div class="topic">
            9. Snap to grid on_drop
        </div>
        <div class="text">
            The items can be moved now, but they don't follow the grid.
            <br>Let's round the position when we drop it.
            <br>Draggable's will automatically call on_drag() and on_drop() if has them
            <br>
            <br>round the position on drop
            <div class="spoiler">
                <font color="purple">def</font> append(self, item):
                <br> icon = Draggable(
                <br> parent = inventory.item_parent,
                <br> model = <font color="green">'quad'</font>,
                <br> texture = item,
                <br> color = color.white,
                <br> origin = (-.5,.5),
                <br> position = self.find_free_spot(),
                <br> z = -.1,
                <br> )
                <br> name = item.replace(<font color="green">'_'</font>, <font color="green">' '</font>).title()
                <br> icon.tooltip = Tooltip(name)
                <br> icon.tooltip.background.color = color.color(0,0,0,.8)
                <br>
                <br>
                <br><mark>
                    <font color="purple">def</font> drop():
                </mark>
                <br><mark> icon.x = int(icon.x) </mark>
                <br><mark> icon.y = int(icon.y) </mark>
                <br>
                <br>
                <br><mark> icon.drop = drop </mark>
            </div>
        </div>
        <div class="topic">
            10. Swap items<br>
        </div>
        <div class="text">
            <div class="spoiler">
                <font color="purple">def</font> drop():
                <br> icon.x = int(icon.x)
                <br> icon.y = int(icon.y)
                <br>
                <br>
                <font color="green">
                    <font color="green">''</font>
                </font>'if the spot is taken, swap positions<font color="green">
                    <font color="green">''</font>
                </font>'
                <br><mark> for c in self.children: </mark>
                <br><mark> if c == icon: </mark>
                <br><mark> continue </mark>
                <br>
                <br><mark> if c.x == icon.x and c.y == icon.y: </mark>
                <br><mark> print(<font color="green">'swap positions'</font>) </mark>
                <br><mark> c.position = icon.org_pos </mark>
                <br>
                <br>
                <br> icon.drop = drop
                <br>
                <font color="gray"># icon.drag = drag</font>
            </div>
        </div>
        <div class="topic">
            11. Stay inside the inventory, please
        </div>
        <div class="text">
            We shouldn't be able to drop the items outside of the inventory.
            <div class="spoiler">
                <font color="purple">def</font> drop():
                <br> icon.x = int(icon.x)
                <br> icon.y = int(icon.y)
                <br>
                <font color="gray"># icon.z += .01</font>
                <br>
                <font color="gray"># if outside, return to original position # +</font><mark> if icon.x < 0 or icon.x>= 1 or icon.y > 0 or icon.y <= -1:</0>
                            </0></mark>
                <br> <mark> icon.position = (icon.org_pos) </mark>
                <br> <mark> return </mark>
                <br>
                <br>
                <font color="gray"># if the spot is taken, swap positions</font>for c in self.children:
                <br> if c == icon:
                <br> continue
                <br>
                <br> if c.x == icon.x and c.y == icon.y:
                <br> print(<font color="green">'swap positions'</font>)
                <br> c.position = icon.org_pos
                <br>
                <br>
                <br> .drop = drop
                <br>
                <font color="gray"># icon.drag = drag</font>
            </div>
        </div>
        <div class="topic">
            12. Make the dragged items render on top
        </div>
        <div class="text">
            All the item's are at the same depth, so it hard to say how they will overlap.
            <br>It feels natural that the item we're currently dragging stays on top,
            <br>so we'll move it back a bit when we drag it and forward when we drop it.
        </div>
    </div>
</body>

<footer>
    ursina engine:
    <br>
    <br>
    <a href=" https://github.com/pokepetter/ursina" class="button">GitHubðŸ¡•</a>
    <a href=" https://twitter.com/ursinaengine" class="button">TwitterðŸ¡•</a>
</footer>

</html>
